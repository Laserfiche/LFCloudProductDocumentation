<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:conditions="Default.API">
    <head><title>Search</title>
    </head>
    <body>
        <h1>Search</h1>
        <p>Use the search API to find entries in your Laserfiche Cloud repository. <a href="https://doc.laserfiche.com/api-reference/en-us/repository/index.html" target="_blank">See the reference</a> for more information on the Laserfiche API.</p>
        <p>A search operation uses a similar flow as the <a href="api-long-op.htm">long operation</a> pattern.</p>
        <ol>
            <li>The client application launches a search query by calling the search API</li>
            <li>The API call will immediately return a token  while the search will continue to run in Laserfiche Cloud. </li>
            <li>The client application can check the status of the operation by using the token returned in step 2.</li>
            <li>When the operation completes, the result of the operation can also be retrieved by using the same token returned in step 2.</li>
        </ol>
        <p>In the following example, we'll search a specific folder, <i>Meeting Minutes</i>, for document text, fields, annotation text, and entry names for the phrase <i>Windham Ave</i>:</p>
        <div class="Code"><pre xml:space="preserve">POST /v1-alpha/Repositories/{repoId}/Searches
{
    "searchCommand": "{LF:Basic ~= \"Windham Ave\", option=\"DFANLT\"} &amp; ({LF:LOOKIN=\"\\Meeting Minutes\"})"
}</pre>
        </div>
        <p class="note"><b>Note:</b> See the Laserfiche user guide for more information on the <a href="https://www.laserfiche.com/support/webhelp/Laserfiche/10/en-us/userguide/#../Subsystems/client_wa/Content/Search/Advanced/Basic_Search.htm" target="_blank">Laserfiche Search Syntax</a>. </p>
        <p>This call will return a token that represents the running search operation.</p>
        <div class="Code"><pre xml:space="preserve">HTTP 202 Accepted
{
    "token": "<i>12345678-abcd-efgh-ijkl-123456789012</i>"
}</pre>
        </div>
        <p>Check the status of the search operation by calling GET /v1-alpha/Repositories/{<i>repoId</i>}/Searches/{<i>searchToken</i>}/Results with the returned token:</p>
        <div class="Code">GET /v1-alpha/Repositories/{<i>repoId</i>}/Searches/{<i>12345678-abcd-efgh-ijkl-123456789012</i>}/Results</div>
        <p>If the search is still in progress, the response will return the status of the operation, for example:</p>
        <div class="Code"><pre xml:space="preserve">HTTP 202 Accepted
{
    "operationToken": "12345678-abcd-efgh-ijkl-123456789012",
    "operationType": "Search",
    "percentComplete": 50,
    "status": "InProgress",
    "errors": []
}</pre>
        </div>
        <p>With a completed search, the response will contain a list of entries representing the results of your search query, for example:</p>
        <div class="Code"><pre xml:space="preserve">HTTP 200 Ok
{
    "value": [
      {
        "id": <i>1234</i>,
        "name": "<i>MinutesDocument</i>",
        "parentId": <i>1230</i>,
        "fullPath": "",
        "folderPath": "",
        "creator": "<i>apipreview@laserfiche.com</i>",
        "creationTime": "<i>2020-12-12T12:00:00-00:00</i>",
        "lastModifiedTime": "<i>2020-12-12T12:00:00-00:00</i>",
        "entryType": "Document",
        "templateName": null,
        "templateId": 0,
        "templateFieldNames": [],
        "volumeName": "DEFAULTVOLUME",
        "rowNumber": 1
      },
      {
        "id": <i>1235</i>,
        "name": "<i>MeetingNotes</i>",
        "parentId": <i>1230</i>,
        "fullPath": "",
        "folderPath": "",
        "creator": "<i>apipreview@laserfiche.com</i>",
        "creationTime": "<i>2020-12-12T12:00:00-00:00</i>",
        "lastModifiedTime": "<i>2020-12-12T12:00:00-00:00</i>",
        "entryType": "Document",
        "templateName": null,
        "templateId": 0,
        "templateFieldNames": [],
        "volumeName": "DEFAULTVOLUME",
        "rowNumber": 2
      },
      ...
    ]
}</pre>
        </div>
        <p>To get the text context hits for a document in the search results, we can call GET /v1-alpha/Repositories/{<i>repoId</i>}/Searches/{<i>searchToken</i>}/Results/{<i>rowNumber</i>}/ContextHits with the appropriate row number of the search result.</p><pre class="Code">GET /v1-alpha/Repositories/{<i>repoId</i>}/Searches/{<i>searchToken</i>}/Results/{<i>rowNumber</i>}/ContextHits</pre>
        <p>The call will return all of the context hits with "Windham Ave" that was found in the specified document.</p>
        <div class="Code"><pre xml:space="preserve">HTTP 200 Ok
{
  "value": [
    {
      "hitNumber": 1,
      "hitType": "PageContent",
      "isAnnotationHit": false,
      "annotationId": 0,
      "pageNumber": 1,
      "pageOffset": 75,
      "context": " need to travel to Windham Ave on Monday to start the ",
      "highlight1Offset": 20,
      "highlight1Length": 7,
      "highlight2Offset": 0,
      "highlight2Length": 0,
      "hitWidth": 1,
      "edocHitCount": 0,
      "fieldHitCount": 0,
      "fieldName": ""
    },
    {
      "hitNumber": 2,
      "hitType": "PageContent",
      "isAnnotationHit": false,
      "annotationId": 0,
      "pageNumber": 1,
      "pageOffset": 140,
      "context": " rebuild the skating rink around Windham Ave will begin after construction ",
      "highlight1Offset": 20,
      "highlight1Length": 3,
      "highlight2Offset": 0,
      "highlight2Length": 0,
      "hitWidth": 1,
      "edocHitCount": 0,
      "fieldHitCount": 0,
      "fieldName": ""
   },
   ...
 ]
}</pre>
        </div>
        <p class="note"><b>Note:</b> Only 2 searches can be active per user session. If you started a search and want to cancel the search, use the <b>DELETE /v1-alpha/Repositories/{<i>repoId</i>}/Searches/{<i>searchToken</i>}</b> call to remove the search. Even if a search operation has completed, the search results are cached by your session and the search will still be considered open. If you are finished using the results of the search, it is a recommended practice to DELETE the search. If you have run 2 searches in your session without deleting them, you must delete one before running another search.</p>
    </body>
</html>