<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1>
            <MadCap:concept term="Import Agent;Email Archive" />Creating an <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> Profile</h1>
        <p><MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> profiles define the rules that determine which emails will be imported to <MadCap:variable name="DoNotTranslate.Laserfiche" />, where they will be saved, and the metadata that will be applied to them. </p>
        <p style="font-weight: bold;">To create a profile</p>
        <ol>
            <li>Open the <b><MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> Configuration</b> dialog box from the Windows Start Menu.</li>
            <li>Select <b>Profile</b> from the menu, and then select <b>Add profile</b>.</li>
            <li>Enter your <MadCap:variable name="DoNotTranslate.Laserfiche" /> repository and authentication information. Select the <b>Cloud</b> tab to log into <MadCap:variable name="DoNotTranslate.LF Cloud" />. and provide a user (not built -in system)&#160;account ID, username, and password. We recommend using a <a href="ServicePrincipals.htm#ServicePrincipals.htm" target="_blank" title="Click to learn more." alt="Click to learn more.">Service Principal</a> user, which is a secure, unlicensed user that Laserfiche provides for connecting applications. </li>
            <li>On the <b>General</b> tab, name your profile.</li>
            <li>Select <b>IMAP</b> to periodically poll a monitored email folder for emails to send to email archive. The  <MadCap:variable name="DoNotTranslate.SMTP" /> option is being deprecated and is not recommended.</li>
            <li><a name="Under"></a>Under <b>Mail server</b>, for <b>Authentication Type</b>, select  either Basic Authentication or Microsoft 365 OAuth 2.0.</li>
            <ol style="list-style-type: lower-alpha;">
                <li>If you selected Basic Authentication, configure the following:<ul><li><b>Server:</b> Your mail server's URL. For Gmail, this is imap.gmail.com.</li><li><b>Port:</b> The standard  IMAP server ports are 143 (non-encrypted) and 993 (SSL).</li><li><b>Use SSL:</b> Select this option to use a SSL connection to the server.</li><li><b>Username:</b> The username of the account associated with the mailbox Email Archive will monitor.</li><li><b>Password:</b> If you selected BasicAuth, enter the password for the account. </li><li><b>Shared mailbox alias:</b> If you want <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> to monitor a shared mailbox, instead of the mailbox associated with a single account, enter the mailbox's name here. For Exchange 2003-2019, ensure the username entered above is in the format: DomainName\Username\SharedMailboxAlias. For Office 365/Exchange Online, use the format: Username@DomainName\SharedMailboxAlias</li></ul></li>
                <li>If you selected Microsoft 365 OAuth 2.0, configure the following:</li>
                <ul>
                    <li><b>Username:</b> The username of the account associated with the mailbox Email Archive will monitor.</li>
                    <li><b>Application (client) ID:</b> This is the application ID assigned to your app. The ID can be found in the portal where the app was registered.</li>
                    <li><b>Client secret:</b> The client secret generated for the app in the app registration portal. </li>
                    <li><b>Tenant ID:</b> The directory tenant that granted the app the permissions requested, in GUID format. The ID can be found in the portal where the app was registered.</li>
                    <p class="note"><b>Note:</b> To use <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> with Microsoft 365 OAuth 2.0, you must enable the API permissions “Mail.Read” and “Mail.ReadWrite” in Microsoft Azure. <MadCap:toggler targets="AzureInstructions">Learn more.</MadCap:toggler></p>
                </ul>
                <div MadCap:targetName="AzureInstructions">
                    <p style="font-weight: bold;">To Configure Microsoft Azure </p>
                    <ol>
                        <li>Go to <i>https://portal.azure.com/#home</i>. </li>
                        <li>Navigate to <b>App registrations</b> (you may want to search for it), and then select <b>New registration</b>.</li>
                        <li>Provide an application name, and then select <b>Accounts in any organizational directory and personal Microsoft accounts</b>.</li>
                        <li>Click <b>Register</b>.</li>
                        <li>Azure AD will assign a unique application (client) ID to your app, and then take you to your application's Overview page. Click <b>Certificates and secrets</b>. </li>
                        <li>Under <b>Client secrets</b>, add a new client secret. Provide a description and an expiration time period, and click <b>Add</b>.</li>
                        <p class="w"><b>Important:</b> Keep a record of your client secret value because it will be hidden next time you view it. </p>
                        <li>On the <b>App registrations</b> page, click the app you just created, and then select <b>Authentication</b>.</li>
                        <li>Click <b>Add a platform</b>, and select <b>Mobile and desktop applications</b>.</li>
                        <li>Select <i>https://login.microsoftonline.com/common/oauth2/nativeclient</i> and <i> https://login.live.com/oauth20_desktop.srf (LiveSDK)</i>. Then, click <b>Configure</b>.</li>
                        <li>Under <b>Advanced settings</b>, enable <b>Live SDK support</b> and <b>Default client type</b>. </li>
                        <li>Click <b>Save</b>.</li>
                        <li>Navigate to <b>API permissions</b>.</li>
                        <li>Select, <b>Add a permission</b>, then <b>Microsoft Graph</b>, and then <b>Application permissions</b>. </li>
                        <li>Under <b>Mail</b>, select <b>Mail.Read</b> and <b>Mail.ReadWrite</b>.</li>
                        <li>Click <b>Add permissions</b>. </li>
                        <li>Click <b>Grant admin consent for Laserfiche</b>.</li>
                    </ol>
                </div>
                <li><b>Test Connection:</b> Click this button to ensure <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> can connect to your Exchange server using the credentials you provided. </li>
            </ol>
            <li>Under <b>Message retrieval</b>, enter the following:</li>
            <ol style="list-style-type: lower-alpha;">
                <li><b>Polling interval in minutes:</b> Specify how frequently <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> will poll the monitored folder for emails to archive. </li>
                <li><b>Retrieve unread messages and set their status to read:</b> Select this option if you want <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> to change the status of messages it's processed to "read."  You will still need to either delete or move processed emails (configured under <b>Post-processing</b>) regardless of whether messages are set to read or not.</li>
            </ol>
            <li>Under <b>Post-processing</b>, enter the following:</li>
            <ol style="list-style-type: lower-alpha;">
                <li><b>Monitored folder:</b> Enter the path of the email folder you want <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> to monitor and retrieve emails from. (E.g., Inbox or Inbox\Contracts). Any subfolders in the folder you specify here will also be monitored and their contents archived. </li>
                <p class="note"><b>Note:</b> Only one profile should be associated with each monitored folder. Running two profiles on the same folder may cause emails to be processed twice or not at all.</p>
                <li><b>Permanently delete messages once they are archived:</b> Select this option to delete emails from the mail server after they've been archived to <MadCap:variable name="DoNotTranslate.Laserfiche" />. </li>
                <li><b>Mail folder for messages archived to <MadCap:variable name="DoNotTranslate.Laserfiche" />:</b> If you chose not to delete archived emails, then  specify a folder in your mailbox where emails will be sent after they are archived to <MadCap:variable name="DoNotTranslate.Laserfiche" />. If the folder doesn't already exist, <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> will create it. </li>
                <p class="note"><b>Note:</b> If you don't delete processed emails or specify a processing folder, emails will be repeatedly imported as there is no indication that they've already been processed.</p>
                <li><b>Mail folder for messages that encountered an error during retrieval:</b> Specify a folder in your mailbox where emails will be sent if they encounter an error during archival. If the folder doesn't already exist, <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> will create it. If an error occurs, the Windows Event Viewer on the workstation where <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> is installed will include the details of the error.</li>
            </ol>
            <li>Under <b>Repository information</b>, you can update the repository in which <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> will save messages. </li>
            <li><a name="For"></a><b>For <MadCap:variable name="DoNotTranslate.SMTP" /> configurations only:</b> Use the <b>Import Rules</b> tab to specify which emails to import to <MadCap:variable name="DoNotTranslate.Laserfiche" />. You can configure rules to only import emails from specific email addresses, emails that have specific email subjects, and/or emails that were sent to specific email addresses. If you do not configure any rules, then all emails sent to the recipient email address for the <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> service will be imported. </li>
            <p>
                <ul>
                    <li>Use regular expressions to detect email addresses or subjects that follow a specific pattern. <a href="Resources/Regular Expressions/Regular-Expressions.htm#../Subsystems/regex/Content/Regular-Expressions.htm" target="_blank" title="Click to learn more." alt="Click to learn more.">Learn more</a>. </li>
                    <li>Use the <b>Advanced</b> option to configure&#160;your rules directly in the profile's <MadCap:variable name="DoNotTranslate.XML" />. <a href="email-archive-import-XML.htm#Import" title="Click here to learn more." alt="Click here to learn more.">Learn more</a>.</li>
                </ul>
            </p>
            <li>Use the <b>Archived Messages</b> tab to configure the message and attachment documents archived to your repository.  <ol style="list-style-type: lower-alpha;"><li><b>Document properties:</b> Provide a name and location for the archived emails. You can use tokens to customize the name and file path based on the email's properties. <a href="Import-Agent-Tokens.htm" title="Click here to learn more." alt="Click here to learn more.">Learn more about tokens</a>. Additionally, select the <MadCap:variable name="DoNotTranslate.Laserfiche" /> volume where the emails will be archived.</li><p class="ex"><b>Tip:</b> To use the volume assigned to the parent folder the email will be saved in, select <b>Use parent folder's default volume</b>. For example, if you configured a profile to archive email to a <MadCap:variable name="DoNotTranslate.Laserfiche" /> folder named <b>Contracts</b>, and this folder had been previously configured to use a default volume named <b>Accounting</b>, emails imported via this profile would be stored in the <b>Accounting</b> volume.</p><li><b>Generate text settings:</b> Select if you want to generate text from the email to make it searchable in the <MadCap:variable name="DoNotTranslate.Laserfiche" /> repository, and specify the number of lines of text on each page. </li><li><a name="Attachme"></a><b>Attachment handling:</b> Select how attachments will be archived to <MadCap:variable name="DoNotTranslate.Laserfiche" />. You can:<ul><li> Include the attachments in the message document</li><li>Save attachments in a separate document </li><li>Save the attachments in the message document and save them as separate documents</li><li>Save the attachments as separate documents and discard the email message</li></ul></li><li><b>Optional:</b>&#160;If you select to save attachments separately from email messages, there are several options to configure how attachments are saved.<ul><li><b>Save attachments with these file extensions:</b> Specify the file extensions attachments can have for them to be archived to <MadCap:variable name="DoNotTranslate.Laserfiche" />. Files with different extensions than the ones listed here will be ignored. Separate acceptable file extensions with commas. If you don't specify any file extensions here, all attachments (regardless of extension)&#160;will be saved. </li><li><b>Apply the Laserfiche metadata configured in the Templates &amp; Fields tab to attachments:</b> Select this option to apply the fields and values configured in the <b>Templates &amp; Fields</b> tab to all attachments. </li><li><b>Ignore inline attachments:</b>&#160;Select this option to ignore attachments that have been embedded in the body of an email message. Clear this option to save these attachments as separate documents. </li><li><b>Generate <MadCap:variable name="DoNotTranslate.Laserfiche" /> pages for <MadCap:variable name="DoNotTranslate.PDF" /> attachments:</b> Enable <MadCap:variable name="DoNotTranslate.Laserfiche Email Archive" /> to generate Laserfiche pages for <MadCap:variable name="DoNotTranslate.PDF" /> attachments as they're saved to <MadCap:variable name="DoNotTranslate.Laserfiche" />. </li><ul><li><b>Keep original <MadCap:variable name="DoNotTranslate.PDF" /> files:</b> Retain the <MadCap:variable name="DoNotTranslate.PDF" /> file after generating <MadCap:variable name="DoNotTranslate.TIFF" /> image pages. The import process will import the original unaltered <MadCap:variable name="DoNotTranslate.PDF" /> along with the <MadCap:variable name="DoNotTranslate.TIFF" /> image pages.</li><li><b>Preserve <MadCap:variable name="DoNotTranslate.PDF" /> annotations on <MadCap:variable name="DoNotTranslate.Laserfiche" /> pages:</b> Convert <MadCap:variable name="DoNotTranslate.PDF" /> annotations to the equivalent <MadCap:variable name="DoNotTranslate.Laserfiche" /> annotations when generating <MadCap:variable name="DoNotTranslate.TIFF" /> image pages.</li><li><b>Import monochrome images:</b> By default, the import process attempts to verify color information in an imported <MadCap:variable name="DoNotTranslate.PDF" /> to determine whether to generate image or monochrome images. Select this option to speed <MadCap:variable name="DoNotTranslate.PDF" /> importing and always create monochrome images, </li><li><b>Create pages at DPI:</b> By default, Import Agent generates <MadCap:variable name="DoNotTranslate.TIFF" /> images that are 300x300 DPI. Select this checkbox to configure a different DPI value.</li></ul></ul></li><li><b>Error handling:</b> Configure how the mail will be processed if there are metadata errors or if a document with the same name already exists in the repository. </li></ol></li>
            <li>Use <b>Template and Fields</b> and <b>Tag</b> tabs to configure the <a href="Fields_and_Templates.htm#../Subsystems/client_wa/Content/Metadata/Fields_and_Templates.htm" target="_blank">templates, fields</a>, and <a href="Tags.htm#../Subsystems/client_wa/Content/Metadata/Tags.htm" target="_blank">tags</a> that will be applied to archived emails. Using a multi-value token in a multi-value field will append each value to the field.</li>
            <li>When you have finished configuring your profile, click <b>OK</b>. </li>
        </ol>
    </body>
</html>